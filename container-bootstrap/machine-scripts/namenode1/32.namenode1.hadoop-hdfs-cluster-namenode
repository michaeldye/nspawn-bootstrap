#!/bin/bash -e

SOURCE=$(realpath $(dirname $0))

source $SOURCE/scripts-include-pkg

HOST=$1; shift
DOMAIN=$1; shift

echo "Executing setup of hadoop hdfs namenode $HOST.$DOMAIN"

source ~admin/.bash_profile

cp $SOURCE/fs/etc/systemd/system/hadoop-namenode.service /etc/systemd/system/
cp $SOURCE/fs/etc/systemd/system/hadoop-namenode-format.service /etc/systemd/system/

FL=/namenode-needs-format.flag
touch $FL && chown admin:admin $FL

if [ ! -e "/etc/systemd/system/multi-user.target.wants/hadoop-namenode.service" ]; then
  ln -s /etc/systemd/system/hadoop-namenode.service /etc/systemd/system/multi-user.target.wants/
fi

if [ ! -e "/etc/systemd/system/multi-user.target.wants/hadoop-namenode-format.service" ]; then
  ln -s /etc/systemd/system/hadoop-namenode-format.service /etc/systemd/system/multi-user.target.wants/
fi

# location set in /usr/hadoop/etc/hadoop/hdfs-site.xml
mkdir -p /data/namenode/current
chown -R admin:admin /data

exit 0
